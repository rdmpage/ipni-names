<?php

// Get DOI agency for a set of DOI prefixes

require_once (dirname(__FILE__) . '/lib.php');

$dois=array(
"10.1002/1522-239X(200208)113:3/4<261::AID-FEDR261>3.0.CO;2-R",
"10.1006/bojl.1994.1012",
"10.1007/978-3-662-49260-4",
"10.1016/0304-3770(75)90036-4",
"10.1017/CBO9781139107679.009",
"10.1038/118623a0",
"10.1046/j.1095-8339.2002.00027.x",
"10.1071/bru9780045",
"10.1078/1439-6092-00050",
"10.1080/00173137409429902",
"10.1086/297055",
"10.1093/aob/mcg184",
"10.1098/rstb.1906.0009",
"10.1111/1467-8748.00271",
"10.11110/kjpt.2013.43.1.12",
"10.1127/0006-8152/2002/0124-0013",
"10.1139/b05-161",
"10.11606/issn.2316-9052.v10i0p15-24",
"10.11609/jott.2167.8.2.8421-8433",
"10.11646/1132",
"10.1179/204234811X13194453002869",
"10.1186/1999-3110-54-25",
"10.11913/PSJ.2095-0837.2014.60567",
"10.11926/j.issn.1005-3395.2014.06.011",
"10.11931/guihaia.gxzw201503036",
"10.12651/JSR.2017.6.1.051",
"10.12705/622.1",
"10.12905/0380.phyton56(2)2016-0129",
"10.13057/biodiv",
"10.13102/neod.11.1",
"10.1360/aps020152",
"10.1371/journal.pone.0010502",
"10.14203/reinwardtia.v10i1.251",
"10.14258/turczaninowia.16.3.1",
"10.14522/darwiniana.2015.31.645",
"10.1515/pbj-2015-0002",
"10.15281/jplantres1887.10.114_55",
"10.15381/rpb.v11i2.2448",
"10.15393/j4.art.2015.3082",
"10.15407/ukrbotj71.01.036",
"10.15446/caldasia.v38n2.60919",
"10.15517//lank.v16i2.25997",
"10.15553/c2010v651a1",
"10.1556/034.57.2015.3-4.1",
"10.15625/0866-7160/v38n4.8837",
"10.1590/0102-33062014abb3668",
"10.1600/0363644041744310",
"10.1640/0002-8444(2001)091[0001:tgoagi]2.0.co;2",
"10.1663/0006-8101(2002)068[0335:pcoema]2.0.co;2",
"10.17110/StudBot.2015.46.2.205",
"10.17129/botsci.103",
"10.17223/20764103.111.1",
"10.17581/bp.2015.04105",
"10.18636/bioneotropical.v6i2.342",
"10.18942/apg.201515",
"10.20324/nelumbo",
"10.20531/tfb.2016.44.1.08",
"10.20546/ijcrbp.2017.405.012",
"10.21276/Ijpaes",
"10.21474/IJAR01",
"10.21498/2518-1017.1-2(26-27).2015.55859",
"10.21782/RMAR1995-2449-2016-3(17-21)",
"10.2179/11-022",
"10.21829/abm1.1988.557",
"10.22092/ijb.2017.107596.1132",
"10.22497/arnaldoa.232.23201",
"10.22621/cfn.v129i2.1698",
"10.2307/1215974",
"10.2478/biorc-2013-0004",
"10.25223/brad.n1.1983.a10",
"10.25224/1097-993X-20.1.4",
"10.26492/gbs69(2).2017-06",
"10.2982/0012-8317(2005)94[165:ANTAFT]2.0.CO;2",
"10.2984/67.2.7",
"10.2985/0007-9367-83.4.169",
"10.2988/0006-324X(2006)119[600:SOTGVA]2.0.CO;2",
"10.3100/0.25.016.0201",
"10.3119/0035-4902(2006)108[228:iniaah]2.0.co;2",
"10.3120/0024-9637(2005)52[202:ansosb]2.0.co;2",
"10.3158/2158-5520-17.10.1",
"10.3159/TORREY-D-11-00061.1",
"10.3264/FG.2004.0127",
"10.3321/j.issn:1000-4025.1999.03.030",
"10.3329/bjpt.v19i1.10939",
"10.3372/wi.26.2602",
"10.3390/plants5020023",
"10.3398/064.076.0305",
"10.3406/jatba.1930.4916",
"10.3417/0026-6493(2006)93[122:asrocs]2.0.co;2",
"10.3724/SP.J.1142.2011.10038",
"10.3732/ajb.0700006",
"10.3767/000651903x489384",
"10.3850/S2010098116000046",
"10.3860/acta.v55i0.1485",
"10.3897/BDJ.2.e4281",
"10.3906/bot-1006-6",
"10.3969/j.issn.1000-3142.1999.01.004",
"10.3989/ajbm.1997.v55.i1.256",
"10.4038/tapro.v6i2.7229",
"10.4067/s0717-66432000000100004",
"10.4081/nhs.2018.365",
"10.4102/abc.v10i1.1504",
"10.4236/ajps.2012.31002",
"10.4314/ejb.v13i1.6",
"10.509/plecevo.2013.765",
"10.5091/plecevo.2010.365",
"10.5169/seals-28398",
"10.5209/rev_LAZA.2011.v32.37817",
"10.5252/a2009n1a1",
"10.5281/zenodo.159691",
"10.5377/ceiba.v48i1-2.439",
"10.5380/abpr.v21i0.749",
"10.5479/si.0081024x.1",
"10.5586/asbp.1930.013",
"10.5642/aliso.19480101.02",
"10.5735/085.045.0107",
"10.5852/ejt.2013.54",
"10.5897/AJB11.302",
"10.5902/2358198013883",
"10.5962/bhl.title.2302",
"10.6165/tai.1948.1.69",
"10.7320/Bocc25.005",
"10.7525/j.issn.1673-5102.2006.01.002",
"10.7550/rmb.32014",
"10.7677/ynzwyj201312041",
"10.7717/peerj.2800",
"10.7732/kjpr.2012.25.3.346",
"10.7751/telopea10316",
"10.1002/1522-239X(200208)113:3/4<261::AID-FEDR261>3.0.CO;2-R");

// if
$dois=array(
"10.1002/1522-239X(200205)113:1/2%3C112::AID-FEDR112%3E3.0.CO;2-H",
"10.1006/jipa.1993.1038",
"10.1007/BF00393470",
"10.1016/0022-2011(65)90009-1",
"10.1017/S0024282900000049",
"10.1023/A:1000136001613",
"10.1038/srep25179",
"10.1051/rnd:19881108",
"10.1071/AP04001",
"10.1078/0723-2020-00026",
"10.1080/00288250709509709",
"10.1086/325133",
"10.1093/femsyr/fou003",
"10.1094/PHYTO-01-10-0029",
"10.1099/00207713-24-4-486",
"10.1111/1567-1364.12044",
"10.1127/0029-5035/2002/0074-0075",
"10.1128/JCM.00683-16",
"10.1139/b00-082",
"10.1144/sjg2014-026",
"10.11609/JoTT.o2056.705-8",
"10.11646/3307",
"10.12705/633.36",
"10.12905/0380.sydowia66(1)2014-0019",
"10.13346/j.mycosystema.140275",
"10.1371/journal.pone.0015614",
"10.1515/botm.1973.16.4.201",
"10.15281/jplantres1887.10.107_19",
"10.15407/ukrbotj71.06.728",
"10.15553/c2015v702a1",
"10.1556/034.57.2015.3-4.7",
"10.1590/0001-3765201520130450",
"10.1600/036364412X656536",
"10.1615/IntJMedMushr.v12.i1.80",
"10.1639/0007-2745(1904)7[35:TFSOTH]2.0.CO;2",
"10.1663/0007-196X(2003)54[262:TAANSO]2.0.CO;2",
"10.17110/StudBot.2015.46.2.95",
"10.2179/11-042",
"10.2307/1216052",
"10.2323/jgam.1.173",
"10.3100/0.25.016.0205",
"10.3114/sim.2006.56.01",
"10.3159/10-RA-019R.1",
"10.3372/wi.28.2818",
"10.3406/linly.1961.6939",
"10.3724/SP.J.1143.2008.08156",
"10.3732/ajb.0800078",
"10.3767/003158508x286842",
"10.3852/06-157",
"10.3897/mycokeys.11.5409",
"10.3906/bot-1206-32",
"10.3969/j.issn.2095-0845.1999.01.007",
"10.4102/abc.v45i1.148",
"10.4467/16890027AP.12.023.0783",
"10.4489/MYCO.2006.34.3.111",
"10.5091/plecevo.2010.427",
"10.5248/109.1",
"10.5586/am.1965.001",
"10.5598/1imafungus.2011.02.01.07",
"10.5735/085.045.0413",
"10.5941/MYCO.2013.41.4.243",
"10.5943/mycosphere/2/5/9",
"10.5962/bhl.title.40287",
"10.6165/tai.1977.22.29",
"10.7751/telopea19814953",
"10.7872/crym.v32.iss1.2012.025",
"10.1002/1522-239X(200205)113:1/2%3C112::AID-FEDR112%3E3.0.CO;2-H");

$dois=array(
'10.1640/0002-8444(2003)093[0032:ncitta]2.0.co;2',
'10.5169/seals-71621',
'10.4102/abc.v45i1.883'
);

$dois=array();

$dois=array('10.14203/reinwardtia.v17i1.3517',
'10.1640/0002-8444-108.1.27',
'10.3417/2018170',
'10.1093/botlinnean/boy055',
'10.3417/2018053',
'10.3417/D1700005',
'10.3417/2018066',
'10.1640/0002-8444-108.3.65',
'10.3417/2018278',
'10.3417/2018056',
'10.3417/2018106',
'10.1002/fedr.201700020',
'10.1093/botlinnean/boy030',
'10.1093/botlinnean/boy056',
'10.3417/2018064',
'10.3417/2018039',
'10.1002/fedr.201800002',
'10.3417/2017049',
'10.3119/17-08',
'10.1093/botlinnean/boy040',
'10.1002/fedr.201700004',
'10.3417/2018209',
'10.3417/2018131',
'10.3417/D1700007',
'10.3417/2017043',
'10.3417/2017058',
'10.1093/aob',
'10.1002/fedr.201700018',
'10.3417/2018201',
'10.3417/2017018',
'10.1002/fedr.201700003',
'10.3417/2018037',
'10.3417/2018078',
'10.22244/rheedea.2018.28.1.05',
'10.1002/fedr.201700007',
'10.3417/D1700002',
'10.3417/2018264',
'10.1093/botlinnean/box088',
'10.1093/botlinnean/box089',
'10.15517/lank.v18i1.33098',
'10.15517/lank.v18i3.35123',
'10.3417/2018063',
'10.15517/lank.v18i2.34050',
'10.15517/lank.v18i2.33398',
'10.3417/2018121',
'10.15517/lank.v18i2.33322',
'10.3417/2017041',
'10.14203/reinwardtia.v17i1.3489',
'10.3417/D1700008',
'10.1640/0002-8444-108.1.1',
'10.3417/2018040',
'10.1640/0002-8444-108.3.107',
'10.3417/2017033',);

$count = 1;

foreach ($dois as $doi)
{
	echo "-- $doi\n";
	
	$prefix = substr($doi, 0, strpos($doi, "/"));
	
	//$url = 'http://api.crossref.org/works/' . $doi . '/agency';
	
	$url = 'http://doi.org/ra/' . $doi;
	
	$json = get($url);
	
	//echo $url . "\n";
	//echo $json;
	
	if ($json != '')
	{
		$obj = json_decode($json);
		
		if (isset($obj->message->agency))
		{
			echo "-- $prefix " . $obj->message->agency->id . "\n";
			
			//echo 'UPDATE names_indexfungorum SET doi_agency="' . $obj->message->agency->id . '" WHERE doi LIKE "' . $prefix . '%";' . "\n";
			echo 'UPDATE names SET doi_agency="' . $obj->message->agency->id . '" WHERE doi LIKE "' . $prefix . '%";' . "\n";
		}
		
		if (isset($obj[0]->RA))
		{
			echo "-- $prefix " . $obj[0]->RA . "\n";
			
			//echo 'UPDATE names_indexfungorum SET doi_agency="' . $obj->message->agency->id . '" WHERE doi LIKE "' . $prefix . '%";' . "\n";
			echo 'UPDATE names SET doi_agency="' . strtolower($obj[0]->RA) . '" WHERE doi LIKE "' . $prefix . '%";' . "\n";
		}
		
	}
	
	if (($count++ % 10) == 0)
	{
		$rand = rand(1000000, 3000000);
		echo '-- sleeping for ' . round(($rand / 1000000),2) . ' seconds' . "\n";
		usleep($rand);
	}
	
}	

?>